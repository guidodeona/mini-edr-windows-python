rule Mimikatz_Strings
{
    meta:
        description = "Detecta strings comunes de Mimikatz"
        author = "NEXO EDR"
        severity = "critical"
    
    strings:
        $s1 = "mimikatz" nocase
        $s2 = "gentilkiwi" nocase
        $s3 = "sekurlsa::logonpasswords" nocase
        $s4 = "lsadump::sam" nocase
    
    condition:
        any of them
}

rule Suspicious_PowerShell_Download
{
    meta:
        description = "Detecta comandos sospechosos de PowerShell para descargar archivos"
        author = "NEXO EDR"
        severity = "high"
    
    strings:
        $cmd1 = "Invoke-WebRequest" nocase
        $cmd2 = "DownloadFile" nocase
        $cmd3 = "wget" nocase
        $cmd4 = "curl" nocase
        $exec1 = "IEX" nocase
        $exec2 = "Invoke-Expression" nocase
    
    condition:
        (any of ($cmd*)) and (any of ($exec*))
}

rule Ransomware_Note
{
    meta:
        description = "Detecta notas t√≠picas de ransomware"
        author = "NEXO EDR"
        severity = "critical"
    
    strings:
        $note1 = "your files have been encrypted" nocase
        $note2 = "bitcoin" nocase
        $note3 = "decrypt" nocase
        $note4 = "ransom" nocase
        $note5 = ".onion"
    
    condition:
        2 of them
}

rule Suspicious_Batch_Commands
{
    meta:
        description = "Detecta comandos batch sospechosos"
        author = "NEXO EDR"
        severity = "medium"
    
    strings:
        $cmd1 = "reg add" nocase
        $cmd2 = "schtasks" nocase
        $cmd3 = "vssadmin delete shadows" nocase
        $cmd4 = "bcdedit /set" nocase
        $cmd5 = "wmic" nocase
    
    condition:
        2 of them
}

rule Keylogger_Indicators
{
    meta:
        description = "Detecta indicadores de keyloggers"
        author = "NEXO EDR"
        severity = "high"
    
    strings:
        $api1 = "GetAsyncKeyState"
        $api2 = "SetWindowsHookEx"
        $api3 = "GetForegroundWindow"
        $str1 = "keylog" nocase
        $str2 = "keystroke" nocase
    
    condition:
        2 of them
}

rule Backdoor_Netcat
{
    meta:
        description = "Detecta uso de Netcat para backdoors"
        author = "NEXO EDR"
        severity = "critical"
    
    strings:
        $nc1 = "nc.exe"
        $nc2 = "ncat"
        $nc3 = "-e cmd.exe"
        $nc4 = "-e /bin/sh"
        $nc5 = "-lvp"
    
    condition:
        any of them
}
